# Quick Reference: Frontend â†’ Backend API Integration

## ğŸ¯ At a Glance

| Aspect                 | Details                            |
| ---------------------- | ---------------------------------- |
| **Backend**            | FastAPI (Python 3.11) + PostgreSQL |
| **Frontend (Current)** | Vanilla HTML/CSS/JS (7 pages)      |
| **Frontend (Target)**  | Next.js 14+ with App Router        |
| **API Base**           | `http://127.0.0.1:8000/api/v1`     |
| **Auth**               | JWT tokens (7-day expiry)          |
| **LLM**                | DeepSeek Chat API (with fallback)  |
| **Database**           | 15 tables (Alembic migrations)     |
| **API Endpoints**      | 27 endpoints across 6 routes       |

---

## ğŸ”‘ Critical Integration Points

### 1. Authentication Token

```
Generated by: POST /auth/login
Format: JWT with HS256 algorithm
Payload: { "sub": "email@example.com", "exp": <timestamp> }
Storage: localStorage (key: "auth-storage")
Usage: Authorization: Bearer {token} (all protected endpoints)
Expiry: 7 days (604800 seconds)
```

### 2. Session State

```
Created: POST /sessions â†’ Session object with ID
Updated: POST /sessions/{id}/message â†’ AI response
Finalized: POST /sessions/{id}/finalize â†’ Evaluation
Stored: Backend (PostgreSQL)
Frontend: Zustand store + session ID in URL
```

### 3. Question Flow

```
Listed: GET /questions?track=X&company_style=Y&difficulty=Z
Filtering: Backend applies (no frontend filtering)
Adaptive: Interview engine adjusts difficulty based on performance
Storage: Immutable in database (no updates, only inserts)
```

### 4. Message Exchange

```
User sends: POST /sessions/{id}/message {"message": "..."}
Backend processes: Interview engine analyzes, calls LLM
AI responds: Returns Message object with interviewer role
Frontend displays: Real-time chat interface
History: Queried from Messages table
```

### 5. Evaluation & Scoring

```
Triggered: POST /sessions/{id}/finalize
Backend: Runs LLM evaluator on full transcript
Scoring: Returns rubric (communication, problem_solving, etc.)
Overall Score: 0-100 scale
Storage: Evaluations table (unique per session)
Display: Results page with gauge visualization
```

---

## ğŸŒ HTTP Headers Reference

```
ALL REQUESTS:
  Content-Type: application/json

AUTHENTICATED REQUESTS:
  Authorization: Bearer {access_token}

RESPONSE HEADERS (from backend):
  Content-Type: application/json
  X-Content-Type-Options: nosniff
  X-Frame-Options: DENY
  X-TTS-Provider: elevenlabs|default (TTS only)
```

---

## ğŸ”„ Complete User Journey (API Calls)

```
1. USER SIGNUP
   POST /auth/signup
   â”œâ”€ Input: { email, password, full_name }
   â””â”€ Output: { ok: true, message: "Code sent" }

   â†’ Code received via email (SMTP or console in dev)

2. EMAIL VERIFICATION
   POST /auth/verify
   â”œâ”€ Input: { email, code: "123456" }
   â””â”€ Output: { access_token, token_type: "bearer" }

   â†’ Token stored in localStorage

3. CREATE INTERVIEW SESSION
   POST /sessions
   â”œâ”€ Input: { track, company_style, difficulty, behavioral_questions_target }
   â””â”€ Output: Session { id, stage: "intro", ... }

   â†’ Session ID stored in state/URL

4. INTERVIEW MESSAGES (loop)
   POST /sessions/{id}/message
   â”œâ”€ Input: { message: "user's answer" }
   â””â”€ Output: Message { role: "interviewer", content: "AI followup" }

   â†’ Repeat for each question/followup

5. COMPLETE INTERVIEW
   POST /sessions/{id}/finalize
   â”œâ”€ Input: {}
   â””â”€ Output: Evaluation { overall_score, rubric, summary }

   â†’ Score calculated and stored

6. VIEW RESULTS
   GET /analytics/sessions/{id}/results
   â”œâ”€ Input: None (auth required)
   â””â”€ Output: Evaluation { overall_score, rubric, ... }

   â†’ Display on Results page

7. LOGOUT
   â†’ Clear localStorage auth-storage
   â†’ Redirect to /login
```

---

## âš ï¸ Common Pitfalls & Solutions

### Pitfall 1: Token Expiry

**Problem:** API returns 401 after 7 days
**Solution:**

- Check token expiry before requests (optional)
- On 401, clear token and redirect to login
- User must sign in again

### Pitfall 2: CORS Errors

**Problem:** Browser blocks requests to backend
**Solution:**

- Backend already has CORS enabled
- Check `FRONTEND_ORIGINS` env var in backend
- Add frontend URL: `FRONTEND_ORIGINS=http://localhost:3000`

### Pitfall 3: Validation Errors (422)

**Problem:** API returns validation error
**Solution:**

- Check exact field names (snake_case: `company_style`, not `companyStyle`)
- Verify enum values (e.g., `"google"` not `"Google"`)
- Check max lengths (passwords, text fields)

### Pitfall 4: LLM Offline

**Problem:** AI responses are fallback mode
**Solution:**

- Verify `DEEPSEEK_API_KEY` in backend `.env`
- Check `/ai/status` endpoint for health
- Frontend shows fallback message gracefully

### Pitfall 5: Session Not Found

**Problem:** 404 when accessing session
**Solution:**

- Verify session ID is correct (integer)
- Confirm user owns session (backend checks `user_id`)
- Check session wasn't deleted

---

## ğŸ“Š Key Data Structures

### User

```typescript
{
  id: number;
  email: string;
  full_name?: string;
  role_pref: string; // "SWE Intern", "Software Engineer", etc.
  profile: Record<string, any>;
  is_verified: boolean;
  created_at: string; // ISO 8601
}
```

### Session

```typescript
{
  id: number;
  user_id: number;
  role: string; // "SWE Intern"
  track: string; // "swe_intern", "data_science", etc.
  company_style: string; // "google", "amazon", "general", etc.
  difficulty: string; // "easy", "medium", "hard"
  stage: string; // "intro", "question", "followups", "evaluation", "done"
  questions_asked_count: number;
  max_questions: number;
  behavioral_questions_target: number;
  skill_state: Record<string, any>; // Running rubric scores
  current_question_id?: number;
  created_at: string;
}
```

### Message

```typescript
{
  id: number;
  session_id: number;
  role: string; // "interviewer", "student", "system"
  content: string;
  created_at: string;
}
```

### Evaluation

```typescript
{
  session_id: number;
  overall_score: number; // 0-100
  rubric: {
    communication: number; // 0-10
    problem_solving: number;
    correctness_reasoning: number;
    complexity: number;
    edge_cases: number;
  };
  summary: {
    strengths: string[];
    weaknesses: string[];
    next_steps: string[];
  };
}
```

---

## ğŸš€ Environment Variables

### Backend (.env)

```
# Database
DATABASE_URL=postgresql://user:password@localhost/interview_db

# Auth
SECRET_KEY=your-secret-key-here
ACCESS_TOKEN_EXPIRE_MINUTES=10080  # 7 days

# LLM
DEEPSEEK_API_KEY=sk-...
DEEPSEEK_BASE_URL=https://api.deepseek.com
DEEPSEEK_MODEL=deepseek-chat

# Frontend CORS
FRONTEND_ORIGINS=http://localhost:3000,http://127.0.0.1:3000
```

### Frontend (.env.local)

```
NEXT_PUBLIC_API_BASE=http://127.0.0.1:8000/api/v1
NEXT_PUBLIC_APP_NAME=Interview Prep AI
```

---

## ğŸ§ª Testing Endpoints with cURL

### Test Auth Flow

```bash
# Signup
curl -X POST http://localhost:8000/api/v1/auth/signup \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"Test123!","full_name":"Test User"}'

# Login
curl -X POST http://localhost:8000/api/v1/auth/login \
  -H "Content-Type: application/json" \
  -d '{"email":"test@example.com","password":"Test123!"}'

# Response: { "access_token": "...", "token_type": "bearer" }
TOKEN="<token_from_above>"
```

### Test Session Flow

```bash
# Create session
curl -X POST http://localhost:8000/api/v1/sessions \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"track":"swe_intern","company_style":"google","difficulty":"medium"}'

# Response: { "id": 42, "stage": "intro", ... }
SESSION_ID=42

# Send message
curl -X POST http://localhost:8000/api/v1/sessions/$SESSION_ID/message \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{"message":"I would use a hash map"}'

# Response: { "id": 1, "role": "interviewer", "content": "...", ... }

# Finalize
curl -X POST http://localhost:8000/api/v1/sessions/$SESSION_ID/finalize \
  -H "Content-Type: application/json" \
  -H "Authorization: Bearer $TOKEN" \
  -d '{}'

# Response: { "overall_score": 75, "rubric": {...}, "summary": {...} }
```

### Test Questions

```bash
curl -X GET 'http://localhost:8000/api/v1/questions?track=swe_intern&difficulty=medium' \
  -H "Authorization: Bearer $TOKEN"
```

### Test AI Status

```bash
curl -X GET http://localhost:8000/api/v1/ai/status \
  -H "Authorization: Bearer $TOKEN"

# Response: { "configured": true, "status": "online", ... }
```

---

## ğŸ” Security Checklist

- [x] **Token Storage** - localStorage (safe for JWT, no sensitive data)
- [x] **Token Transmission** - Authorization header (not URL params)
- [x] **HTTPS** - Required in production
- [x] **CORS** - Restricted to frontend origin
- [x] **Password Hashing** - Argon2 (never sent back)
- [x] **Rate Limiting** - Auth endpoints throttled
- [x] **JWT Expiry** - 7 days (reasonable duration)
- [x] **Refresh Tokens** - Not implemented (users re-login after 7 days)

---

## ğŸ“ˆ Performance Metrics

### API Response Times (Expected)

- **Auth endpoints** - < 500ms
- **Session creation** - < 300ms
- **Message + AI response** - 2-5 seconds (LLM processing)
- **Finalization** - 5-10 seconds (full evaluation)
- **Question listing** - < 200ms

### Database Indexes

```
users.email (unique)
interview_sessions.user_id
interview_sessions.created_at
questions.track, company_style, difficulty
messages.session_id
evaluations.session_id (unique)
```

---

## ğŸ¯ Frontend Key Mappings

| Vanilla File                   | Next.js Location                      |
| ------------------------------ | ------------------------------------- |
| `login.html`                   | `src/app/(auth)/login/page.tsx`       |
| `dashboard.html`               | `src/app/(app)/dashboard/page.tsx`    |
| `interview.html`               | `src/app/(app)/interview/page.tsx`    |
| `chat.html`                    | `src/app/(app)/chat/page.tsx`         |
| `results.html`                 | `src/app/(app)/results/[id]/page.tsx` |
| `settings.html`                | `src/app/(app)/settings/page.tsx`     |
| `assets/js/api.js`             | `src/lib/api.ts`                      |
| `assets/js/auth.js`            | `src/lib/services/authService.ts`     |
| `assets/js/interview.part*.js` | `src/lib/hooks/useSession.ts`         |
| `localStorage`                 | Zustand stores + localStorage         |

---

## âœ… Pre-Migration Checklist

- [ ] Backend running locally on `http://127.0.0.1:8000`
- [ ] PostgreSQL database populated with questions
- [ ] DEEPSEEK_API_KEY set in backend `.env`
- [ ] All 27 API endpoints tested with cURL
- [ ] JWT token generation verified
- [ ] Rate limiting working
- [ ] CORS headers present in responses
- [ ] LLM status endpoint responding
- [ ] TTS endpoint functional
- [ ] Database migrations run (`alembic upgrade head`)

---

## ğŸš€ Go-Live Checklist

- [ ] All Next.js pages created
- [ ] All API services implemented
- [ ] Zustand stores initialized
- [ ] Auth flow working end-to-end
- [ ] Interview flow complete
- [ ] Results display accurate
- [ ] Chat interface functional
- [ ] Settings page working
- [ ] Mobile responsive on all devices
- [ ] Error handling for all HTTP status codes
- [ ] Loading states for all async operations
- [ ] Keyboard navigation (a11y)
- [ ] Unit tests passing
- [ ] E2E tests passing
- [ ] Lighthouse score > 90
- [ ] No console errors
- [ ] No memory leaks (DevTools profiler)
- [ ] Production environment variables set
- [ ] HTTPS enabled
- [ ] Error tracking configured
- [ ] Analytics configured

---

## ğŸ“ Debugging Commands

### Check Backend Health

```bash
curl http://127.0.0.1:8000/health
# Expected: { "status": "ok" }
```

### Check Token Validity

```bash
# Decode JWT online: https://jwt.io
# Or in Node.js:
const jwt = require('jsonwebtoken');
jwt.decode(token, {complete: true});
```

### Monitor API Calls

```bash
# In browser DevTools:
// Filter Network tab by Fetch/XHR
// Check Headers tab for Authorization: Bearer {token}
// Check Response tab for JSON structure
```

### Check Database Connection

```bash
# Backend logs should show:
# [INFO] Questions loaded: +150
# [INFO] Database connection established
```

---

## ğŸ“ Learning Resources

### Backend Understanding

- `backend/main.py` - Entry point (lifespan, CORS, routes)
- `backend/app/api/v1/router.py` - Route aggregation
- `backend/app/core/security.py` - JWT & password hashing
- `backend/app/services/interview_engine.py` - Interview logic (2905 lines!)

### Current Frontend Understanding

- `frontend/assets/js/api.js` - API wrapper pattern
- `frontend/assets/js/auth.js` - Auth state management
- `frontend/login.html` - Login UI
- `frontend/interview.html` - Interview UI

### Next.js Best Practices

- Next.js App Router documentation
- React hooks patterns
- Zustand state management
- TypeScript for React

---

## ğŸ”— File Structure Reference

```
interview-prep/                          # Root repo
â”œâ”€â”€ backend/                              # FastAPI backend
â”‚   â”œâ”€â”€ app/
â”‚   â”‚   â”œâ”€â”€ main.py                      # FastAPI app, CORS, lifespan
â”‚   â”‚   â”œâ”€â”€ api/v1/
â”‚   â”‚   â”‚   â”œâ”€â”€ router.py                # Route aggregation
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.py                  # /auth endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ sessions.py              # /sessions endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ questions.py             # /questions endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ ai.py                    # /ai endpoints
â”‚   â”‚   â”‚   â”œâ”€â”€ voice.py                 # /tts endpoints
â”‚   â”‚   â”‚   â””â”€â”€ analytics.py             # /analytics endpoints
â”‚   â”‚   â”œâ”€â”€ models/                      # SQLAlchemy models
â”‚   â”‚   â”œâ”€â”€ schemas/                     # Pydantic request/response
â”‚   â”‚   â”œâ”€â”€ services/                    # Business logic
â”‚   â”‚   â”œâ”€â”€ crud/                        # Database queries
â”‚   â”‚   â””â”€â”€ core/
â”‚   â”‚       â”œâ”€â”€ config.py                # Settings (DATABASE_URL, etc.)
â”‚   â”‚       â””â”€â”€ security.py              # JWT, password hashing
â”‚   â”œâ”€â”€ requirements.txt                 # Python dependencies
â”‚   â””â”€â”€ .env                             # Backend config
â”‚
â”œâ”€â”€ frontend/                             # Current vanilla frontend
â”‚   â”œâ”€â”€ assets/
â”‚   â”‚   â”œâ”€â”€ js/
â”‚   â”‚   â”‚   â”œâ”€â”€ api.js                   # API client pattern
â”‚   â”‚   â”‚   â”œâ”€â”€ auth.js                  # Auth logic
â”‚   â”‚   â”‚   â”œâ”€â”€ interview.part*.js       # Interview logic
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â”œâ”€â”€ css/
â”‚   â”‚   â”‚   â”œâ”€â”€ pro.css                  # Main styles
â”‚   â”‚   â”‚   â””â”€â”€ ...
â”‚   â”‚   â””â”€â”€ images/                      # Logo, hero, etc.
â”‚   â”œâ”€â”€ login.html                       # Auth UI
â”‚   â”œâ”€â”€ dashboard.html                   # Dashboard
â”‚   â””â”€â”€ ...
â”‚
â”œâ”€â”€ data/                                 # Question datasets
â”‚   â””â”€â”€ questions/
â”‚       â”œâ”€â”€ swe_engineer/
â”‚       â”œâ”€â”€ swe_intern/
â”‚       â”œâ”€â”€ behavioral/
â”‚       â””â”€â”€ ...
â”‚
â”œâ”€â”€ NEXTJS_CONVERSION_BLUEPRINT.md       # Architecture guide
â”œâ”€â”€ API_REFERENCE.md                     # API documentation
â”œâ”€â”€ NEXTJS_IMPLEMENTATION_CHECKLIST.md   # Code templates
â””â”€â”€ COMPLETE_ANALYSIS_SUMMARY.md         # This summary
```

---

## ğŸ’¡ Key Insights

1. **Backend is Solid** - Well-structured FastAPI with clear separation of concerns
2. **Frontend is Maintainable** - Vanilla JS is readable but lacks composition
3. **API is Clean** - RESTful endpoints with consistent patterns
4. **Migration is Safe** - Can run both frontends simultaneously
5. **Zero Breaking Changes** - All API compatibility maintained
6. **Performance Gain** - Next.js will be significantly faster
7. **Developer Experience** - React + TypeScript much better for maintenance
8. **Deployment Flexible** - Can rollback instantly if needed

---

## ğŸ Final Words

The Interview Prep AI system is well-architected for migration. The FastAPI backend is solid and will continue to work unchanged. The vanilla frontend works well but will benefit enormously from React's component model and Next.js's performance optimizations.

**All the information needed for a successful migration is in this document and the three supplementary guides. You can proceed with confidence.**

**Key Principle: The backend doesn't need to know or care about frontend changes. Just keep using the same API endpoints.**

Good luck! ğŸš€
